---
title: "Class 1 Reproducible research"
author: "Derek Corcoran"
date: "`r format(Sys.time(), '%d/%m, %Y')`"
output:
  ioslides_presentation:
    widescreen: true
    incremental: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      error = FALSE,
                      message = FALSE)
```

```{r LoadPackages}
library(terra)
library(leaflet)
library(leafsync)
library(tidyterra)
library(ggplot2)
library(geodata)
```


## Definitions

* $\text{L}$ represents the set of Landuses.
* $\text{C}$ represents the set of Cells.
* $\text{S}$ represents Richness.
* $\text{PD}$ represents PhyloDiversity.
* $\text{R}$ represents Rarity.
* $\text{CC}$ represents CanChange.
* $\text{SCB}$ represents SpatialContiguityBonus.
* $\text{EN}$ represents Existingnature.

## Biodivesity

$$\color{Red}{\text{Biodiversity} = \sum_{l}^L \sum_{c}^C \text{LD}_{l,c} \times \frac{\text{S}_{l,c} + \text{PD}_{l,c} + \text{R}_{l,c}}{3} \times \text{CC}_{c}}$$

## Contiguity to new nature

$$
\color{Blue}{\text{Contiguity to new} = \text{SCB} \times \sum_{(i,j)}^E \sum_{l}^L \sum_{c}^C \text{LD}_{l,i} \times \text{LD}_{l,j} \times \text{CC}_{i} \times \text{CC}_{j} }
$$

## Contiguity to existing nature

$$
\color{Green}{\text{Contiguity to existing} = \text{SCB} \times \sum_{(i,j)}^E \sum_{l}^L \sum_{c}^C \text{LD}_{l,i} \times \text{EN}_{l,j} \times \text{CC}_{i}}
$$

## Nice equation?

$$
\text{maximize CI} = \color{Red}{\text{Biodiversity}} + \text{SCB} \times \left( \color{Blue}{\text{Cont}_n} +  \color{Green}{\text{Cont}_{ex}} \right) 
$$

## Before after

```{r before_after}

beforeafter <- terra::rast("Before_After.tif")

Communes <- geodata::gadm("Denmark", level = 2, path = getwd())
Communes <- Communes[Communes$NAME_2 %in% c("Ã…rhus", "Skanderborg", "Syddjurs"),]

Communes <- Communes |> terra::project(terra::crs(beforeafter))

ggplot() + geom_spatvector(data = Communes) + geom_spatraster(data = beforeafter) + scale_fill_manual(values =  c("white","#01665e", "#35978f", "#80cdc1", "#c7eae5", "#f6e8c3", "#dfc27d", 
"#bf812d", "#8c510a"), na.value = "#00000000") + facet_wrap(~lyr) + theme_dark()

```

