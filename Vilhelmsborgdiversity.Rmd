---
title: "Vilhelmsborg Diversity"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      error = FALSE,
                      message = FALSE)
library(terra)
library(leaflet)
library(leaflet.providers)
library(dplyr)

Habs_VilhelmsBorg <- terra::rast("Habs_VilhelmsBorg.tif")
Habs_VilhelmsBorg[Habs_VilhelmsBorg == 0] <- NA

MaxHabitatRast <- terra::rast("MaxHabitatRast.tif")

MaxHabitatRastHab <- terra::rast("MaxHabitatRastHab.tif")
```

In the following document we will have several interactive interpretations of the potential future scenarios of Vilhelmsborg, in the first one in the next map, you can choose which potential habitat to use, and you will see the potential plant species richness

```{r map1, echo = F}
pal <- colorNumeric(c("#3288bd", "#99d594", "#e6f598", "#ffffbf", "#fee08b", "#fc8d59", 
                               "#d53e4f"), values(Habs_VilhelmsBorg),
                    na.color = "grey")



l <- leaflet() |>  
  addProviderTiles("Esri.WorldImagery") 

for(i in 1:nlyr(Habs_VilhelmsBorg)){
  l <- l |> addRasterImage(Habs_VilhelmsBorg[[i]], colors = pal, opacity = 0.7, group = names(Habs_VilhelmsBorg[[i]]))
}
  
  
l |> 
  leaflet::addLegend(pal = pal, values = values(Habs_VilhelmsBorg), title = "Species richness") |> 
  addLayersControl(
    baseGroups = names(Habs_VilhelmsBorg),
    options = layersControlOptions(collapsed = T)
  )
```

## Maximum diversity

Secondly we can create a map with the landuse desicion for each site than ensures the maximum diversity, and what would that maximum diversity be.

This can be seen in this next map


```{r}
palFac <- colorFactor(c('#7fc97f','#beaed4','#fdc086','#ffff99'), levels(MaxHabitatRastHab)[[1]]$value,
                               na.color = "grey")

pal <- colorNumeric(c("#3288bd", "#99d594", "#e6f598", "#ffffbf", "#fee08b", "#fc8d59", 
                               "#d53e4f"), values(MaxHabitatRast),
                               na.color = "grey")



l <- leaflet() |>  
  addProviderTiles("Esri.WorldImagery") |> 
  addRasterImage(MaxHabitatRastHab, colors = palFac, opacity = 0.7, group = "Best habitat") |> 
  leaflet::addLegend(pal = palFac, 
            values = levels(MaxHabitatRastHab)[[1]]$value,
            title = "Land Cover",
            labFormat  = labelFormat(
              transform = function(x) {
                levels(MaxHabitatRastHab)[[1]]$label[which(levels(MaxHabitatRastHab)[[1]]$value == x)]
              }), group = "Best habitat") |> 
  addRasterImage(MaxHabitatRast, colors = pal, opacity = 0.7, group = "Maximum diversity") |> 
  leaflet::addLegend(pal = pal, values = values(Habs_VilhelmsBorg), title = "Species richness", group = "Maximum diversity") |> 
  addLayersControl(
    baseGroups = c("Best habitat", "Maximum diversity"),
    options = layersControlOptions(collapsed = T)
  )

l
```

